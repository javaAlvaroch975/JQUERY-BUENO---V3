<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>√Ålbumes de Kanye West</title>
    <link rel="stylesheet" href="styles.css">
    <!-- IMPORTAR JQUERY -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>üéµ √Ålbumes de Kanye West üéµ</h1>
            <p>Descubre todos sus √°lbumes disponibles</p>
            <a href="indexform.html" class="nav-btn">üó≥Ô∏è Votar Canciones</a>
        </header>

        <!-- DIV FRASES DE KANYE -->
        <div class="quote-section">
            <p class="quote-text">Pulsa aqui para escuchar una frase estupida de Kanye</p>
            <button id="quote-btn" class="quote-btn">Hazme click</button>
            <div id="quote-display" class="quote-display"></div>
        </div>
        
        <!-- Para cargar los albumes, luego en la linea 50 lo veras -->
        <div class="loader">
            <div class="spinner"></div>
            <p>Cargando</p>
        </div>

        <!-- Declaracion de albumes y errores -->
        <div id="albums-container" class="albums-grid"></div>
        <div id="error-container"></div>
    </div>

    <script>
        // Cuando la pagina este lista, se cargaran todos los albumes (los de Kanye, solo he cogido ese artista)
        $(document).ready(function() {
            cargarAlbumes();
            
            // Obtener una frase al pulsar el boton
            $('#quote-btn').click(function() {
                obtenerFrase();
            });
        });

        // FUNCION CARGAR ALBUMES KAYNE
        function cargarAlbumes() {
            $('.loader').show(); //mostrar el div de antes
            
            // API iTunes -> √°lbumes de Kanye West
            var APIiTunes = 'https://itunes.apple.com/search?term=kanye+west&entity=album&limit=200';
            
            // TRAER DATOS Y CONVERTIRLOS A JSON
            fetch(APIiTunes)
                .then(function(respuesta) {
                    return respuesta.json();
                })
                .then(function(datos) {
                    // Ocultar el loader, porque ya han cargado los datos
                    $('.loader').hide();
                    
                    // Comprobante para ver si coge los datos
                    if (datos.results && datos.results.length > 0) {
                        // Array para los √°lbumes √∫nicos
                        var albumes_Unicos = [];

                        // Array para guardar los nombres que ya han salido
                        var albumes_Vistos = []; 
                        
                        // Recorrer los resultados
                        for (var i = 0; i < datos.results.length; i++) {
                            var album_Actual = datos.results[i];
                            var album_Nombre = album_Actual.collectionName;
                            
                            // Comprobante para que no sean repetidos
                            if (album_Actual.collectionType === 'Album') {
                                var anyadido = false; //refactorizar el nombre a otro
                                for (var j = 0; j < albumes_Vistos.length; j++) {
                                    if (albumes_Vistos[j] === album_Nombre) {
                                        anyadido = true;
                                        break;
                                    }
                                }
                                
                                // A√±adirlo si no existe
                                if (anyadido === false) {
                                    albumes_Unicos.push(album_Actual);
                                    albumes_Vistos.push(album_Nombre);
                                }
                            }
                        }
                        
                        // Mostrar los albumes unicos
                        if (albumes_Unicos.length > 0) {
                            mostrar_Albumes(albumes_Unicos);
                        } else {
                            // Si no hay albumes porque no los ha cogido
                            var no_unicos = '<div class="no-results">No se encontraron albumes</div>';
                            $('#albums-container').html(no_unicos);
                        }
                    } else {
                        // Si no coge los datos al llamar la API
                        var no_obtenidos = '<div class="no-results">No se encontraron albumes</div>';
                        $('#albums-container').html(no_obtenidos);
                    }
                })
                .catch(function(error) {
                    // Si hay un error, ocultamos el loader
                    $('.loader').hide();
                    // Mostrar el error en la consola
                    console.log('Hubo un error al cargar los albumes:', error);
                    // Mostrar mensaje de error al usuario
                    var mensajeDeError = '<div class="error">Error al cargar los albumes.</div>';
                    $('#error-container').html(mensajeDeError);
                });
        }

        // FUNCI√ìN PARA MOSTRAR ALBUMES
        function mostrar_Albumes(albumes) {
            // Variable para guardar todo el HTML que vamos a crear
            var htmlCompleto = '';
            
            // Recorrer los albumes
            for (var indice = 0; indice < albumes.length; indice++) {
                var album_Seleccionado = albumes[indice];
                
                // Obtener titulo
                var album_Titulo = '';
                if (album_Seleccionado.collectionName) {
                    album_Titulo = album_Seleccionado.collectionName;
                } else {
                    album_Titulo = 'Sin t√≠tulo';
                }
                
                // Obtener nombre 
                var album_Artista = '';
                if (album_Seleccionado.artistName) {
                    album_Artista = album_Seleccionado.artistName;
                } else {
                    album_Artista = 'Artista desconocido';
                }
                
                // Obtener la imagen
                var album_Imagen = '';
                if (album_Seleccionado.artworkUrl100) {
                    // Uso 250x250 para ir de 4 en 4 y que no sea muy grande
                    album_Imagen = album_Seleccionado.artworkUrl100.replace('100x100', '250x250');
                } else {
                    album_Imagen = '';
                }
                
                // Obtener la URL de itunes
                var album_Url = '';
                if (album_Seleccionado.collectionViewUrl) {
                    album_Url = album_Seleccionado.collectionViewUrl;
                } else {
                    album_Url = '#';
                }
                
                // Obtener el a√±o de lanzamiento
                var album_A√±o = 'N/A';
                if (album_Seleccionado.releaseDate) {
                    var fecha = new Date(album_Seleccionado.releaseDate);
                    album_A√±o = fecha.getFullYear();
                }
                
                // Obtener el numero de canciones
                var numero_Canciones = 0;
                if (album_Seleccionado.trackCount) {
                    numero_Canciones = album_Seleccionado.trackCount;
                }
                
                // TARJETAS DE ALBUMES (html completo + campos)
                var tarjeta_Album = '';
                tarjeta_Album = tarjeta_Album + '<div class="album-card">';
                tarjeta_Album = tarjeta_Album + '<img src="' + album_Imagen + '" alt="' + album_Titulo + '" class="album-image">';
                tarjeta_Album = tarjeta_Album + '<div class="album-info">';
                tarjeta_Album = tarjeta_Album + '<div class="album-title">' + album_Titulo + '</div>';
                tarjeta_Album = tarjeta_Album + '<div class="album-artist">' + album_Artista + '</div>';
                tarjeta_Album = tarjeta_Album + '<div class="album-year">üìÖ ' + album_A√±o + '</div>';
                tarjeta_Album = tarjeta_Album + '<div class="album-tracks">üéµ ' + numero_Canciones + ' canciones</div>';
                tarjeta_Album = tarjeta_Album + '<a href="' + album_Url + '" target="_blank" class="album-link">Ver en iTunes</a>';
                tarjeta_Album = tarjeta_Album + '</div>';
                tarjeta_Album = tarjeta_Album + '</div>';
                
                // A√±adir esta tarjeta al HTML completo
                htmlCompleto = htmlCompleto + tarjeta_Album;
            }
            
            // Poner todo el HTML en el contenedor de albumes
            $('#albums-container').html(htmlCompleto);
        }

        // FUNCION PARA LAS FRASES DE KANYE
        function obtenerFrase() {
            // Deshabilitar el boton para evitar multiples clciks
            var boton_frases_Kayne = $('#quote-btn');
            boton_frases_Kayne.prop('disabled', true);
            
            // Mostrar mensaje de carga
            var frases_Kayne = $('#quote-display');
            frases_Kayne.text('Cargando frase...');
            
            // URL de la API de frases de Kanye
            var APIKayne = 'https://api.kanye.rest/';
            
            // PETICIONES A LA API
            fetch(APIKayne)
                .then(function(server_Response) {
                    // Comprobar si lo que recibimos es correcto
                    if (server_Response.ok === false) {
                        throw new Error('Error en la respuesta');
                    }
                    // Convertir a JSON
                    return server_Response.json();
                })
                .then(function(frase_Recibida) {
                    // Mostrar en consola lo que recibimos
                    console.log('Datos recibidos:', frase_Recibida);
                    
                    // Verificar si hay una frase
                    if (frase_Recibida.quote) {
                        // Obtener la frase y meterle comillas
                        var frase = frase_Recibida.quote;
                        var frase_completa = '"' + frase + '"';
                        
                        // Mostrarla en la p√°gina
                        frases_Kayne.text(frase_completa);
                    } else {
                        // Mostrar error si no coge la frase
                        frases_Kayne.text('No se pudo obtener la frase');
                    }
                    
                    // Volver a habilitar el bot√≥n
                    boton_frases_Kayne.prop('disabled', false);
                })
                .catch(function(errorQueOcurrio) {
                    // Mostrar el error en consola
                    console.error('Error:', errorQueOcurrio);

                    // Mostrar mensaje de error
                    frases_Kayne.text('Error al obtener la frase.');

                    // Volver a habilitar el bot√≥n
                    boton_frases_Kayne.prop('disabled', false);
                });
        }
    </script>
</body>
</html>