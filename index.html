<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>√Ålbumes de Kanye West</title>
    <link rel="stylesheet" href="styles.css">
    <!-- IMPORTAR JQUERY -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>üéµ √Ålbumes de Kanye West üéµ</h1>
            <p>Descubre todos sus √°lbumes disponibles</p>
            <a href="indexform.html" class="nav-btn">üó≥Ô∏è Votar Canciones</a>
        </header>

        <!-- DIV FRASES DE KANYE -->
        <div class="quote-section">
            <p class="quote-text">Pulsa aqui para escuchar una frase estupida de Kanye</p>
            <button id="quote-btn" class="quote-btn">Hazme click</button>
            <div id="quote-display" class="quote-display"></div>
        </div>
        
        <!-- Para cargar los albumes, luego en la linea 50 lo veras -->
        <div class="loader">
            <div class="spinner"></div>
            <p>Cargando</p>
        </div>

        <!-- Declaracion de albumes y errores -->
        <div id="albums-container" class="albums-grid"></div>
        <div id="error-container"></div>
    </div>

    <script>
        // Cuando la pagina este lista, se cargaran todos los albumes (los de Kanye, solo he cogido ese artista)
        $(document).ready(function() {
            cargarAlbumes();
            
            // Obtener una frase al pulsar el boton
            $('#quote-btn').click(function() {
                obtenerFrase();
            });
        });

        // FUNCION CARGAR ALBUMES KAYNE
        function cargarAlbumes() {
            $('.loader').show(); //mostrar el div de antes
            
            // API iTunes -> √°lbumes de Kanye West
            var urlDeLaAPI = 'https://itunes.apple.com/search?term=kanye+west&entity=album&limit=200';
            
            // TRAER DATOS Y CONVERTIRLOS A JSON
            fetch(urlDeLaAPI)
                .then(function(respuesta) {
                    return respuesta.json();
                })
                .then(function(datos) {
                    // Ocultar el loader, porque ya han cargado los datos
                    $('.loader').hide();
                    
                    // Comprobante para ver si coge los datos
                    if (datos.results && datos.results.length > 0) {
                        // Array para los √°lbumes √∫nicos
                        var albumesUnicosArray = [];
                        // Array para guardar los nombres que ya han salido
                        var nombresQueYaVimos = []; //refactorizar el nombre a otro
                        
                        // Recorrer los resultados
                        for (var i = 0; i < datos.results.length; i++) {
                            var albumActual = datos.results[i];
                            var nombreDelAlbum = albumActual.collectionName;
                            
                            // Comprobante para que no sean repetidos
                            if (albumActual.collectionType === 'Album') {
                                var yaExiste = false; //refactorizar el nombre a otro
                                for (var j = 0; j < nombresQueYaVimos.length; j++) {
                                    if (nombresQueYaVimos[j] === nombreDelAlbum) {
                                        yaExiste = true;
                                        break;
                                    }
                                }
                                
                                // A√±adirlo si no existe
                                if (yaExiste === false) {
                                    albumesUnicosArray.push(albumActual);
                                    nombresQueYaVimos.push(nombreDelAlbum);
                                }
                            }
                        }
                        
                        // Mostrar los albumes unicos
                        if (albumesUnicosArray.length > 0) {
                            mostrarAlbumes(albumesUnicosArray);
                        } else {
                            // Si no hay √°lbumes, mostrar mensaje
                            var mensajeNoResultados = '<div class="no-results">No se encontraron √°lbumes</div>';
                            $('#albums-container').html(mensajeNoResultados);
                        }
                    } else {
                        // Si no hay resultados, mostrar mensaje
                        var mensajeNoResultados2 = '<div class="no-results">No se encontraron √°lbumes</div>';
                        $('#albums-container').html(mensajeNoResultados2);
                    }
                })
                .catch(function(error) {
                    // Si hay un error, ocultamos el loader
                    $('.loader').hide();
                    // Mostrar el error en la consola
                    console.log('Hubo un error:', error);
                    // Mostrar mensaje de error al usuario
                    var mensajeDeError = '<div class="error">Error al cargar los √°lbumes. Verifica tu conexi√≥n e intenta de nuevo.</div>';
                    $('#error-container').html(mensajeDeError);
                });
        }

        // FUNCI√ìN PARA MOSTRAR ALBUMES
        function mostrarAlbumes(albumesParaMostrar) {
            // Variable para guardar todo el HTML que vamos a crear
            var htmlCompleto = '';
            
            // Recorrer cada √°lbum uno por uno
            for (var indice = 0; indice < albumesParaMostrar.length; indice++) {
                // Guardar el √°lbum actual en una variable
                var elAlbum = albumesParaMostrar[indice];
                
                // Obtener el t√≠tulo del √°lbum
                var tituloDelAlbum = '';
                if (elAlbum.collectionName) {
                    tituloDelAlbum = elAlbum.collectionName;
                } else {
                    tituloDelAlbum = 'Sin t√≠tulo';
                }
                
                // Obtener el nombre del artista
                var nombreDelArtista = '';
                if (elAlbum.artistName) {
                    nombreDelArtista = elAlbum.artistName;
                } else {
                    nombreDelArtista = 'Artista desconocido';
                }
                
                // Obtener la imagen del √°lbum
                var imagenDelAlbum = '';
                if (elAlbum.artworkUrl100) {
                    // Cambiar el tama√±o de la imagen a 250x250
                    imagenDelAlbum = elAlbum.artworkUrl100.replace('100x100', '250x250');
                } else {
                    imagenDelAlbum = '';
                }
                
                // Obtener la URL del √°lbum en iTunes
                var urlEnItunes = '';
                if (elAlbum.collectionViewUrl) {
                    urlEnItunes = elAlbum.collectionViewUrl;
                } else {
                    urlEnItunes = '#';
                }
                
                // Obtener el a√±o de lanzamiento
                var a√±oDelAlbum = 'N/A';
                if (elAlbum.releaseDate) {
                    var fechaCompleta = new Date(elAlbum.releaseDate);
                    a√±oDelAlbum = fechaCompleta.getFullYear();
                }
                
                // Obtener el n√∫mero de canciones
                var numeroDeCanciones = 0;
                if (elAlbum.trackCount) {
                    numeroDeCanciones = elAlbum.trackCount;
                }
                
                // Crear el HTML para esta tarjeta de √°lbum
                var htmlDeLaTarjeta = '';
                htmlDeLaTarjeta = htmlDeLaTarjeta + '<div class="album-card">';
                htmlDeLaTarjeta = htmlDeLaTarjeta + '<img src="' + imagenDelAlbum + '" alt="' + tituloDelAlbum + '" class="album-image">';
                htmlDeLaTarjeta = htmlDeLaTarjeta + '<div class="album-info">';
                htmlDeLaTarjeta = htmlDeLaTarjeta + '<div class="album-title">' + tituloDelAlbum + '</div>';
                htmlDeLaTarjeta = htmlDeLaTarjeta + '<div class="album-artist">' + nombreDelArtista + '</div>';
                htmlDeLaTarjeta = htmlDeLaTarjeta + '<div class="album-year">üìÖ ' + a√±oDelAlbum + '</div>';
                htmlDeLaTarjeta = htmlDeLaTarjeta + '<div class="album-tracks">üéµ ' + numeroDeCanciones + ' canciones</div>';
                htmlDeLaTarjeta = htmlDeLaTarjeta + '<a href="' + urlEnItunes + '" target="_blank" class="album-link">Ver en iTunes</a>';
                htmlDeLaTarjeta = htmlDeLaTarjeta + '</div>';
                htmlDeLaTarjeta = htmlDeLaTarjeta + '</div>';
                
                // A√±adir esta tarjeta al HTML completo
                htmlCompleto = htmlCompleto + htmlDeLaTarjeta;
            }
            
            // Poner todo el HTML en el contenedor de √°lbumes
            $('#albums-container').html(htmlCompleto);
        }

        // FUNCION PARA LAS FRASES DE KANYE
        function obtenerFrase() {
            // Deshabilitar el bot√≥n para que no se pueda hacer click m√∫ltiples veces
            var botonDeFrases = $('#quote-btn');
            botonDeFrases.prop('disabled', true);
            
            // Mostrar mensaje de carga
            var divDeFrases = $('#quote-display');
            divDeFrases.text('Cargando frase...');
            
            // URL de la API de frases de Kanye
            var urlDeLaAPIDeKanye = 'https://api.kanye.rest/';
            
            // Hacer la petici√≥n a la API
            fetch(urlDeLaAPIDeKanye)
                .then(function(respuestaDelServidor) {
                    // Verificar si la respuesta est√° bien
                    if (respuestaDelServidor.ok === false) {
                        throw new Error('Error en la respuesta');
                    }
                    // Convertir a JSON
                    return respuestaDelServidor.json();
                })
                .then(function(datosRecibidos) {
                    // Mostrar en consola lo que recibimos
                    console.log('Datos recibidos:', datosRecibidos);
                    
                    // Verificar si hay una frase
                    if (datosRecibidos.quote) {
                        // Obtener la frase
                        var laFrase = datosRecibidos.quote;
                        // Agregarle comillas
                        var fraseConComillas = '"' + laFrase + '"';
                        // Mostrarla en la p√°gina
                        divDeFrases.text(fraseConComillas);
                    } else {
                        // Si no hay frase, mostrar error
                        divDeFrases.text('No se pudo obtener la frase');
                    }
                    
                    // Volver a habilitar el bot√≥n
                    botonDeFrases.prop('disabled', false);
                })
                .catch(function(errorQueOcurrio) {
                    // Mostrar el error en consola
                    console.error('Error:', errorQueOcurrio);
                    // Mostrar mensaje de error
                    divDeFrases.text('Error al obtener la frase. Intenta de nuevo.');
                    // Volver a habilitar el bot√≥n
                    botonDeFrases.prop('disabled', false);
                });
        }
    </script>
</body>
</html>